
#   Z80 CPU Emulator.
#   https://github.com/kosarev/z80
#
#   Copyright (C) 2017-2019 Ivan Kosarev.
#   ivan@kosarev.info
#
#   Published under the MIT license.


# ADD r
87 add a, a
 0 m1_fetch
 0   fetch 87 at 0000
 0     get_pc_on_fetch 0000
 0     set_addr_bus 0000 -> 0000
 2     mreq_wait 0000
 2     get_ir_on_refresh 0000
 2     set_addr_bus 0000 -> 0000
 4     set_pc_on_fetch 0000 -> 0001
 4   set_r 00 -> 01
 4 get_a 00
 4 get_a 00
 4 set_a 00 -> 00
 4 set_f 00 -> 40
 4 done

# ADD A, n
c616 add a, 0x16
 0 m1_fetch
 0   fetch c6 at 0000
 0     get_pc_on_fetch 0000
 0     set_addr_bus 0000 -> 0000
 2     mreq_wait 0000
 2     get_ir_on_refresh 0000
 2     set_addr_bus 0000 -> 0000
 4     set_pc_on_fetch 0000 -> 0001
 4   set_r 00 -> 01
 4 imm8_read 16 at 0001
 4   get_pc_on_imm8_read 0001
 4   read 16 at 0001
 4     set_addr_bus 0000 -> 0001
 6     mreq_wait 0001
 7   set_pc_on_imm8_read 0001 -> 0002
 7 get_a 00
 7 set_a 00 -> 16
 7 set_f 00 -> 00
 7 done

# ADD HL, rp
19 add hl, de
 0 m1_fetch
 0   fetch 19 at 0000
 0     get_pc_on_fetch 0000
 0     set_addr_bus 0000 -> 0000
 2     mreq_wait 0000
 2     get_ir_on_refresh 0000
 2     set_addr_bus 0000 -> 0000
 4     set_pc_on_fetch 0000 -> 0001
 4   set_r 00 -> 01
 4 get_l 00
 4 get_h 00
 4 get_e 00
 4 get_d 00
 4 get_f 00
 4 4t_exec
 8 3t_exec
11 set_wz 0000 -> 0001
11 set_l 00 -> 00
11 set_h 00 -> 00
11 set_f 00 -> 00
11 done

# ADC A, r
89 adc a, c
 0 m1_fetch
 0   fetch 89 at 0000
 0     get_pc_on_fetch 0000
 0     set_addr_bus 0000 -> 0000
 2     mreq_wait 0000
 2     get_ir_on_refresh 0000
 2     set_addr_bus 0000 -> 0000
 4     set_pc_on_fetch 0000 -> 0001
 4   set_r 00 -> 01
 4 get_c 00
 4 get_a 00
 4 get_f 00
 4 set_a 00 -> 00
 4 set_f 00 -> 40
 4 done

# ADC HL, rp
ed5a adc hl, de
 0 m1_fetch
 0   fetch ed at 0000
 0     get_pc_on_fetch 0000
 0     set_addr_bus 0000 -> 0000
 2     mreq_wait 0000
 2     get_ir_on_refresh 0000
 2     set_addr_bus 0000 -> 0000
 4     set_pc_on_fetch 0000 -> 0001
 4   set_r 00 -> 01
 4 m1_fetch
 4   fetch 5a at 0001
 4     get_pc_on_fetch 0001
 4     set_addr_bus 0000 -> 0001
 6     mreq_wait 0001
 6     get_ir_on_refresh 0001
 6     set_addr_bus 0001 -> 0001
 8     set_pc_on_fetch 0001 -> 0002
 8   set_r 01 -> 02
 8 get_l 00
 8 get_h 00
 8 get_e 00
 8 get_d 00
 8 get_f 00
 8 4t_exec
12 3t_exec
15 set_wz 0000 -> 0001
15 set_l 00 -> 00
15 set_h 00 -> 00
15 set_f 00 -> 40
15 done

# AND r
a7 and a
 0 m1_fetch
 0   fetch a7 at 0000
 0     get_pc_on_fetch 0000
 0     set_addr_bus 0000 -> 0000
 2     mreq_wait 0000
 2     get_ir_on_refresh 0000
 2     set_addr_bus 0000 -> 0000
 4     set_pc_on_fetch 0000 -> 0001
 4   set_r 00 -> 01
 4 get_a 00
 4 get_a 00
 4 set_a 00 -> 00
 4 set_f 00 -> 54
 4 done

# BIT b, r
fdcb014e bit 1, (iy + 1)
 0 m1_fetch
 0   fetch fd at 0000
 0     get_pc_on_fetch 0000
 0     set_addr_bus 0000 -> 0000
 2     mreq_wait 0000
 2     get_ir_on_refresh 0000
 2     set_addr_bus 0000 -> 0000
 4     set_pc_on_fetch 0000 -> 0001
 4   set_r 00 -> 01
 4 set_index_rp hl -> iy
 4 disable_int
 4 m1_fetch
 4   fetch cb at 0001
 4     get_pc_on_fetch 0001
 4     set_addr_bus 0000 -> 0001
 6     mreq_wait 0001
 6     get_ir_on_refresh 0001
 6     set_addr_bus 0001 -> 0001
 8     set_pc_on_fetch 0001 -> 0002
 8   set_r 01 -> 02
 8 disp_read 01 at 0002
 8   get_pc_on_disp_read 0002
 8   read 01 at 0002
 8     set_addr_bus 0001 -> 0002
10     mreq_wait 0002
11   set_pc_on_disp_read 0002 -> 0003
11 fetch 4e at 0003
11   get_pc_on_fetch 0003
11   set_addr_bus 0002 -> 0003
13   mreq_wait 0003
13   get_ir_on_refresh 0002
13   set_addr_bus 0003 -> 0002
15   set_pc_on_fetch 0003 -> 0004
15 fetch_cycle_extra_1t
16 get_iyl 00
16 get_iyh 00
16 read cb at 0001
16   set_addr_bus 0002 -> 0001
18   mreq_wait 0001
19 read_cycle_extra_1t
20 set_wz 0000 -> 0001
20 get_f 00
20 set_f 00 -> 10
20 set_index_rp iy -> hl
20 done

# CALL nn
cddf0e call 0x0edf
 0 m1_fetch
 0   fetch cd at 0000
 0     get_pc_on_fetch 0000
 0     set_addr_bus 0000 -> 0000
 2     mreq_wait 0000
 2     get_ir_on_refresh 0000
 2     set_addr_bus 0000 -> 0000
 4     set_pc_on_fetch 0000 -> 0001
 4   set_r 00 -> 01
 4 imm16_read 0edf at 0001
 4   get_pc_on_imm16_read 0001
 4   read df at 0001
 4     set_addr_bus 0000 -> 0001
 6     mreq_wait 0001
 7   read 0e at 0002
 7     set_addr_bus 0001 -> 0002
 9     mreq_wait 0002
10   set_pc_on_imm16_read 0001 -> 0003
10 read_cycle_extra_1t
11 get_sp 0000
11 write 00 -> 00 at ffff
11   set_addr_bus 0002 -> ffff
13   mreq_wait ffff
14 write 00 -> 03 at fffe
14   set_addr_bus ffff -> fffe
16   mreq_wait fffe
17 set_sp 0000 -> fffe
17 set_wz 0000 -> 0edf
17 set_pc_on_call 0003 -> 0edf
17 done

# CALL cc, nn
c4550c call nz, 0x0c55
 0 m1_fetch
 0   fetch c4 at 0000
 0     get_pc_on_fetch 0000
 0     set_addr_bus 0000 -> 0000
 2     mreq_wait 0000
 2     get_ir_on_refresh 0000
 2     set_addr_bus 0000 -> 0000
 4     set_pc_on_fetch 0000 -> 0001
 4   set_r 00 -> 01
 4 imm16_read 0c55 at 0001
 4   get_pc_on_imm16_read 0001
 4   read 55 at 0001
 4     set_addr_bus 0000 -> 0001
 6     mreq_wait 0001
 7   read 0c at 0002
 7     set_addr_bus 0001 -> 0002
 9     mreq_wait 0002
10   set_pc_on_imm16_read 0001 -> 0003
10 get_f 00
10 read_cycle_extra_1t
11 get_sp 0000
11 write 00 -> 00 at ffff
11   set_addr_bus 0002 -> ffff
13   mreq_wait ffff
14 write 00 -> 03 at fffe
14   set_addr_bus ffff -> fffe
16   mreq_wait fffe
17 set_sp 0000 -> fffe
17 set_wz 0000 -> 0c55
17 set_pc_on_call 0003 -> 0c55
17 done

# CCF
3f ccf
 0 m1_fetch
 0   fetch 3f at 0000
 0     get_pc_on_fetch 0000
 0     set_addr_bus 0000 -> 0000
 2     mreq_wait 0000
 2     get_ir_on_refresh 0000
 2     set_addr_bus 0000 -> 0000
 4     set_pc_on_fetch 0000 -> 0001
 4   set_r 00 -> 01
 4 get_a 00
 4 get_f 00
 4 set_f 00 -> 01
 4 done

# CP r
bc cp h
 0 m1_fetch
 0   fetch bc at 0000
 0     get_pc_on_fetch 0000
 0     set_addr_bus 0000 -> 0000
 2     mreq_wait 0000
 2     get_ir_on_refresh 0000
 2     set_addr_bus 0000 -> 0000
 4     set_pc_on_fetch 0000 -> 0001
 4   set_r 00 -> 01
 4 get_h 00
 4 get_a 00
 4 set_f 00 -> 42
 4 done

# CPIR
edb1 cpir
 0 m1_fetch
 0   fetch ed at 0000
 0     get_pc_on_fetch 0000
 0     set_addr_bus 0000 -> 0000
 2     mreq_wait 0000
 2     get_ir_on_refresh 0000
 2     set_addr_bus 0000 -> 0000
 4     set_pc_on_fetch 0000 -> 0001
 4   set_r 00 -> 01
 4 m1_fetch
 4   fetch b1 at 0001
 4     get_pc_on_fetch 0001
 4     set_addr_bus 0000 -> 0001
 6     mreq_wait 0001
 6     get_ir_on_refresh 0001
 6     set_addr_bus 0001 -> 0001
 8     set_pc_on_fetch 0001 -> 0002
 8   set_r 01 -> 02
 8 get_c 00
 8 get_b 00
 8 get_l 00
 8 get_h 00
 8 get_a 00
 8 get_f 00
 8 read ed at 0000
 8   set_addr_bus 0001 -> 0000
10   mreq_wait 0000
11 5t_exec
16 set_c 00 -> ff
16 set_b 00 -> ff
16 set_wz 0000 -> 0001
16 set_l 00 -> 01
16 set_h 00 -> 00
16 set_f 00 -> 36
16 5t_exec
21 get_pc_on_block_instr 0002
21 set_wz 0001 -> 0001
21 set_pc_on_block_instr 0002 -> 0000
21 done

# CPL
2f cpl
 0 m1_fetch
 0   fetch 2f at 0000
 0     get_pc_on_fetch 0000
 0     set_addr_bus 0000 -> 0000
 2     mreq_wait 0000
 2     get_ir_on_refresh 0000
 2     set_addr_bus 0000 -> 0000
 4     set_pc_on_fetch 0000 -> 0001
 4   set_r 00 -> 01
 4 get_a 00
 4 get_f 00
 4 set_a 00 -> ff
 4 set_f 00 -> 3a
 4 done

# DAA
27 daa
 0 m1_fetch
 0   fetch 27 at 0000
 0     get_pc_on_fetch 0000
 0     set_addr_bus 0000 -> 0000
 2     mreq_wait 0000
 2     get_ir_on_refresh 0000
 2     set_addr_bus 0000 -> 0000
 4     set_pc_on_fetch 0000 -> 0001
 4   set_r 00 -> 01
 4 get_a 00
 4 get_f 00
 4 set_a 00 -> 00
 4 set_f 00 -> 44
 4 done

# DEC r
35 dec (hl)
 0 m1_fetch
 0   fetch 35 at 0000
 0     get_pc_on_fetch 0000
 0     set_addr_bus 0000 -> 0000
 2     mreq_wait 0000
 2     get_ir_on_refresh 0000
 2     set_addr_bus 0000 -> 0000
 4     set_pc_on_fetch 0000 -> 0001
 4   set_r 00 -> 01
 4 get_l 00
 4 get_h 00
 4 read 35 at 0000
 4   set_addr_bus 0000 -> 0000
 6   mreq_wait 0000
 7 read_cycle_extra_1t
 8 get_f 00
 8 get_l 00
 8 get_h 00
 8 write 35 -> 34 at 0000
 8   set_addr_bus 0000 -> 0000
10   mreq_wait 0000
11 set_f 00 -> 22
11 done

# DEC rp
2b dec hl
 0 m1_fetch
 0   fetch 2b at 0000
 0     get_pc_on_fetch 0000
 0     set_addr_bus 0000 -> 0000
 2     mreq_wait 0000
 2     get_ir_on_refresh 0000
 2     set_addr_bus 0000 -> 0000
 4     set_pc_on_fetch 0000 -> 0001
 4   set_r 00 -> 01
 4 fetch_cycle_extra_2t
 6 get_l 00
 6 get_h 00
 6 set_l 00 -> ff
 6 set_h 00 -> ff
 6 done

# DI
f3 di
 0 m1_fetch
 0   fetch f3 at 0000
 0     get_pc_on_fetch 0000
 0     set_addr_bus 0000 -> 0000
 2     mreq_wait 0000
 2     get_ir_on_refresh 0000
 2     set_addr_bus 0000 -> 0000
 4     set_pc_on_fetch 0000 -> 0001
 4   set_r 00 -> 01
 4 set_iff1_on_di 0 -> 0
 4 set_iff2_on_di 0 -> 0
 4 done

# DJNZ d
10fc djnz $ - 2
 0 m1_fetch
 0   fetch 10 at 0000
 0     get_pc_on_fetch 0000
 0     set_addr_bus 0000 -> 0000
 2     mreq_wait 0000
 2     get_ir_on_refresh 0000
 2     set_addr_bus 0000 -> 0000
 4     set_pc_on_fetch 0000 -> 0001
 4   set_r 00 -> 01
 4 fetch_cycle_extra_1t
 5 disp_read fc at 0001
 5   get_pc_on_disp_read 0001
 5   read fc at 0001
 5     set_addr_bus 0000 -> 0001
 7     mreq_wait 0001
 8   set_pc_on_disp_read 0001 -> 0002
 8 get_b 00
 8 set_b 00 -> ff
 8 5t_exec
13 get_pc_on_jump 0002
13 set_wz 0000 -> fffe
13 set_pc_on_jump 0002 -> fffe
13 done

# EI
fb ei
 0 m1_fetch
 0   fetch fb at 0000
 0     get_pc_on_fetch 0000
 0     set_addr_bus 0000 -> 0000
 2     mreq_wait 0000
 2     get_ir_on_refresh 0000
 2     set_addr_bus 0000 -> 0000
 4     set_pc_on_fetch 0000 -> 0001
 4   set_r 00 -> 01
 4 set_iff1_on_ei 0 -> 1
 4 set_iff2_on_ei 0 -> 1
 4 disable_int
 4 done

# EX AF, AF'
08 ex af, af'
 0 m1_fetch
 0   fetch 08 at 0000
 0     get_pc_on_fetch 0000
 0     set_addr_bus 0000 -> 0000
 2     mreq_wait 0000
 2     get_ir_on_refresh 0000
 2     set_addr_bus 0000 -> 0000
 4     set_pc_on_fetch 0000 -> 0001
 4   set_r 00 -> 01
 4 done

# EX DE, HL
eb ex de, hl
 0 m1_fetch
 0   fetch eb at 0000
 0     get_pc_on_fetch 0000
 0     set_addr_bus 0000 -> 0000
 2     mreq_wait 0000
 2     get_ir_on_refresh 0000
 2     set_addr_bus 0000 -> 0000
 4     set_pc_on_fetch 0000 -> 0001
 4   set_r 00 -> 01
 4 done

# EX (SP), irp
e3 ex (sp), hl
 0 m1_fetch
 0   fetch e3 at 0000
 0     get_pc_on_fetch 0000
 0     set_addr_bus 0000 -> 0000
 2     mreq_wait 0000
 2     get_ir_on_refresh 0000
 2     set_addr_bus 0000 -> 0000
 4     set_pc_on_fetch 0000 -> 0001
 4   set_r 00 -> 01
 4 get_sp 0000
 4 read e3 at 0000
 4   set_addr_bus 0000 -> 0000
 6   mreq_wait 0000
 7 read 00 at 0001
 7   set_addr_bus 0000 -> 0001
 9   mreq_wait 0001
10 read_cycle_extra_1t
11 get_l 00
11 get_h 00
11 write 00 -> 00 at 0001
11   set_addr_bus 0001 -> 0001
13   mreq_wait 0001
14 write e3 -> 00 at 0000
14   set_addr_bus 0001 -> 0000
16   mreq_wait 0000
17 write_cycle_extra_2t
19 set_wz 0000 -> 00e3
19 set_l 00 -> e3
19 set_h 00 -> 00
19 done

# EXX
d9 exx
 0 m1_fetch
 0   fetch d9 at 0000
 0     get_pc_on_fetch 0000
 0     set_addr_bus 0000 -> 0000
 2     mreq_wait 0000
 2     get_ir_on_refresh 0000
 2     set_addr_bus 0000 -> 0000
 4     set_pc_on_fetch 0000 -> 0001
 4   set_r 00 -> 01
 4 done

# HALT
76 halt
 0 m1_fetch
 0   fetch 76 at 0000
 0     get_pc_on_fetch 0000
 0     set_addr_bus 0000 -> 0000
 2     mreq_wait 0000
 2     get_ir_on_refresh 0000
 2     set_addr_bus 0000 -> 0000
 4     set_pc_on_fetch 0000 -> 0001
 4   set_r 00 -> 01
 4 get_pc_on_halt 0001
 4 set_pc_on_halt 0001 -> 0000
 4 done

# IM n
ed56 im 1
 0 m1_fetch
 0   fetch ed at 0000
 0     get_pc_on_fetch 0000
 0     set_addr_bus 0000 -> 0000
 2     mreq_wait 0000
 2     get_ir_on_refresh 0000
 2     set_addr_bus 0000 -> 0000
 4     set_pc_on_fetch 0000 -> 0001
 4   set_r 00 -> 01
 4 m1_fetch
 4   fetch 56 at 0001
 4     get_pc_on_fetch 0001
 4     set_addr_bus 0000 -> 0001
 6     mreq_wait 0001
 6     get_ir_on_refresh 0001
 6     set_addr_bus 0001 -> 0001
 8     set_pc_on_fetch 0001 -> 0002
 8   set_r 01 -> 02
 8 set_int_mode 0 -> 1
 8 done

ed46 im 0
...
 8 done

ed5e im 2
...
 8 done

ed4e xim 0x4e, 0
...
 8 done

ed66 xim 0x66, 0
...
 8 done

ed6e xim 0x6e, 0
...
 8 done

ed76 xim 0x76, 1
...
 8 done

ed7e xim 0x7e, 2
...
 8 done

# INC r
04 inc b
 0 m1_fetch
 0   fetch 04 at 0000
 0     get_pc_on_fetch 0000
 0     set_addr_bus 0000 -> 0000
 2     mreq_wait 0000
 2     get_ir_on_refresh 0000
 2     set_addr_bus 0000 -> 0000
 4     set_pc_on_fetch 0000 -> 0001
 4   set_r 00 -> 01
 4 get_b 00
 4 get_f 00
 4 set_b 00 -> 01
 4 set_f 00 -> 00
 4 done

# INC rp
23 inc hl
 0 m1_fetch
 0   fetch 23 at 0000
 0     get_pc_on_fetch 0000
 0     set_addr_bus 0000 -> 0000
 2     mreq_wait 0000
 2     get_ir_on_refresh 0000
 2     set_addr_bus 0000 -> 0000
 4     set_pc_on_fetch 0000 -> 0001
 4   set_r 00 -> 01
 4 fetch_cycle_extra_2t
 6 get_l 00
 6 get_h 00
 6 set_l 00 -> 01
 6 set_h 00 -> 00
 6 done

# IN A, (n)
dbfe in a, (0xfe)
 0 m1_fetch
 0   fetch db at 0000
 0     get_pc_on_fetch 0000
 0     set_addr_bus 0000 -> 0000
 2     mreq_wait 0000
 2     get_ir_on_refresh 0000
 2     set_addr_bus 0000 -> 0000
 4     set_pc_on_fetch 0000 -> 0001
 4   set_r 00 -> 01
 4 imm8_read fe at 0001
 4   get_pc_on_imm8_read 0001
 4   read fe at 0001
 4     set_addr_bus 0000 -> 0001
 6     mreq_wait 0001
 7   set_pc_on_imm8_read 0001 -> 0002
 7 get_a 00
 7 set_wz 0000 -> 00ff
 7 input at 00fe
 7   set_addr_bus 0001 -> 00fe
10   iorq_wait 00fe
11 set_a 00 -> ff
11 done

# IN r, (C)
ed78 in a, (c)
 0 m1_fetch
 0   fetch ed at 0000
 0     get_pc_on_fetch 0000
 0     set_addr_bus 0000 -> 0000
 2     mreq_wait 0000
 2     get_ir_on_refresh 0000
 2     set_addr_bus 0000 -> 0000
 4     set_pc_on_fetch 0000 -> 0001
 4   set_r 00 -> 01
 4 m1_fetch
 4   fetch 78 at 0001
 4     get_pc_on_fetch 0001
 4     set_addr_bus 0000 -> 0001
 6     mreq_wait 0001
 6     get_ir_on_refresh 0001
 6     set_addr_bus 0001 -> 0001
 8     set_pc_on_fetch 0001 -> 0002
 8   set_r 01 -> 02
 8 get_c 00
 8 get_b 00
 8 get_f 00
 8 set_wz 0000 -> 0001
 8 input at 0000
 8   set_addr_bus 0001 -> 0000
11   iorq_wait 0000
12 set_a 00 -> ff
12 set_f 00 -> ac
12 done

# JP cc, nn
d2d90a jp nc, 0x0ad9
 0 m1_fetch
 0   fetch d2 at 0000
 0     get_pc_on_fetch 0000
 0     set_addr_bus 0000 -> 0000
 2     mreq_wait 0000
 2     get_ir_on_refresh 0000
 2     set_addr_bus 0000 -> 0000
 4     set_pc_on_fetch 0000 -> 0001
 4   set_r 00 -> 01
 4 imm16_read 0ad9 at 0001
 4   get_pc_on_imm16_read 0001
 4   read d9 at 0001
 4     set_addr_bus 0000 -> 0001
 6     mreq_wait 0001
 7   read 0a at 0002
 7     set_addr_bus 0001 -> 0002
 9     mreq_wait 0002
10   set_pc_on_imm16_read 0001 -> 0003
10 get_f 00
10 set_wz 0000 -> 0ad9
10 set_pc_on_jump 0003 -> 0ad9
10 done

# JP irp
e9 jp (hl)
 0 m1_fetch
 0   fetch e9 at 0000
 0     get_pc_on_fetch 0000
 0     set_addr_bus 0000 -> 0000
 2     mreq_wait 0000
 2     get_ir_on_refresh 0000
 2     set_addr_bus 0000 -> 0000
 4     set_pc_on_fetch 0000 -> 0001
 4   set_r 00 -> 01
 4 get_l 00
 4 get_h 00
 4 set_pc_on_jump 0001 -> 0000
 4 done

# JP nn
c3cdab jp 0xabcd
 0 m1_fetch
 0   fetch c3 at 0000
 0     get_pc_on_fetch 0000
 0     set_addr_bus 0000 -> 0000
 2     mreq_wait 0000
 2     get_ir_on_refresh 0000
 2     set_addr_bus 0000 -> 0000
 4     set_pc_on_fetch 0000 -> 0001
 4   set_r 00 -> 01
 4 imm16_read abcd at 0001
 4   get_pc_on_imm16_read 0001
 4   read cd at 0001
 4     set_addr_bus 0000 -> 0001
 6     mreq_wait 0001
 7   read ab at 0002
 7     set_addr_bus 0001 -> 0002
 9     mreq_wait 0002
10   set_pc_on_imm16_read 0001 -> 0003
10 set_wz 0000 -> abcd
10 set_pc_on_jump 0003 -> abcd
10 done

# JR d
1804 jr $ + 6
 0 m1_fetch
 0   fetch 18 at 0000
 0     get_pc_on_fetch 0000
 0     set_addr_bus 0000 -> 0000
 2     mreq_wait 0000
 2     get_ir_on_refresh 0000
 2     set_addr_bus 0000 -> 0000
 4     set_pc_on_fetch 0000 -> 0001
 4   set_r 00 -> 01
 4 disp_read 04 at 0001
 4   get_pc_on_disp_read 0001
 4   read 04 at 0001
 4     set_addr_bus 0000 -> 0001
 6     mreq_wait 0001
 7   set_pc_on_disp_read 0001 -> 0002
 7 5t_exec
12 get_pc_on_jump 0002
12 set_wz 0000 -> 0006
12 set_pc_on_jump 0002 -> 0006
12 done

# JR cc, d
28fa jr z, $ - 4
 0 m1_fetch
 0   fetch 28 at 0000
 0     get_pc_on_fetch 0000
 0     set_addr_bus 0000 -> 0000
 2     mreq_wait 0000
 2     get_ir_on_refresh 0000
 2     set_addr_bus 0000 -> 0000
 4     set_pc_on_fetch 0000 -> 0001
 4   set_r 00 -> 01
 4 disp_read fa at 0001
 4   get_pc_on_disp_read 0001
 4   read fa at 0001
 4     set_addr_bus 0000 -> 0001
 6     mreq_wait 0001
 7   set_pc_on_disp_read 0001 -> 0002
 7 get_f 00
 7 done

200a jr nz, $ + 12
 0 m1_fetch
 0   fetch 20 at 0000
 0     get_pc_on_fetch 0000
 0     set_addr_bus 0000 -> 0000
 2     mreq_wait 0000
 2     get_ir_on_refresh 0000
 2     set_addr_bus 0000 -> 0000
 4     set_pc_on_fetch 0000 -> 0001
 4   set_r 00 -> 01
 4 disp_read 0a at 0001
 4   get_pc_on_disp_read 0001
 4   read 0a at 0001
 4     set_addr_bus 0000 -> 0001
 6     mreq_wait 0001
 7   set_pc_on_disp_read 0001 -> 0002
 7 get_f 00
 7 5t_exec
12 get_pc_on_jump 0002
12 set_wz 0000 -> 000c
12 set_pc_on_jump 0002 -> 000c
12 done

# LD A, I
ed57 ld a, i
 0 m1_fetch
 0   fetch ed at 0000
 0     get_pc_on_fetch 0000
 0     set_addr_bus 0000 -> 0000
 2     mreq_wait 0000
 2     get_ir_on_refresh 0000
 2     set_addr_bus 0000 -> 0000
 4     set_pc_on_fetch 0000 -> 0001
 4   set_r 00 -> 01
 4 m1_fetch
 4   fetch 57 at 0001
 4     get_pc_on_fetch 0001
 4     set_addr_bus 0000 -> 0001
 6     mreq_wait 0001
 6     get_ir_on_refresh 0001
 6     set_addr_bus 0001 -> 0001
 8     set_pc_on_fetch 0001 -> 0002
 8   set_r 01 -> 02
 8 fetch_cycle_extra_1t
 9 get_f 00
 9 set_a 00 -> 00
 9 set_f 00 -> 40
 9 done

# LD A, R
ed5f ld a, r
 0 m1_fetch
 0   fetch ed at 0000
 0     get_pc_on_fetch 0000
 0     set_addr_bus 0000 -> 0000
 2     mreq_wait 0000
 2     get_ir_on_refresh 0000
 2     set_addr_bus 0000 -> 0000
 4     set_pc_on_fetch 0000 -> 0001
 4   set_r 00 -> 01
 4 m1_fetch
 4   fetch 5f at 0001
 4     get_pc_on_fetch 0001
 4     set_addr_bus 0000 -> 0001
 6     mreq_wait 0001
 6     get_ir_on_refresh 0001
 6     set_addr_bus 0001 -> 0001
 8     set_pc_on_fetch 0001 -> 0002
 8   set_r 01 -> 02
 8 fetch_cycle_extra_1t
 9 get_f 00
 9 set_a 00 -> 02
 9 set_f 00 -> 00
 9 done

# LD r, a
ed4f ld r, a
 0 m1_fetch
 0   fetch ed at 0000
 0     get_pc_on_fetch 0000
 0     set_addr_bus 0000 -> 0000
 2     mreq_wait 0000
 2     get_ir_on_refresh 0000
 2     set_addr_bus 0000 -> 0000
 4     set_pc_on_fetch 0000 -> 0001
 4   set_r 00 -> 01
 4 m1_fetch
 4   fetch 4f at 0001
 4     get_pc_on_fetch 0001
 4     set_addr_bus 0000 -> 0001
 6     mreq_wait 0001
 6     get_ir_on_refresh 0001
 6     set_addr_bus 0001 -> 0001
 8     set_pc_on_fetch 0001 -> 0002
 8   set_r 01 -> 02
 8 fetch_cycle_extra_1t
 9 get_a 00
 9 set_r 02 -> 00
 9 done

# LD r, r
47 ld b, a
 0 m1_fetch
 0   fetch 47 at 0000
 0     get_pc_on_fetch 0000
 0     set_addr_bus 0000 -> 0000
 2     mreq_wait 0000
 2     get_ir_on_refresh 0000
 2     set_addr_bus 0000 -> 0000
 4     set_pc_on_fetch 0000 -> 0001
 4   set_r 00 -> 01
 4 get_a 00
 4 set_b 00 -> 00
 4 done

dd6b ld ixl, e
 0 m1_fetch
 0   fetch dd at 0000
 0     get_pc_on_fetch 0000
 0     set_addr_bus 0000 -> 0000
 2     mreq_wait 0000
 2     get_ir_on_refresh 0000
 2     set_addr_bus 0000 -> 0000
 4     set_pc_on_fetch 0000 -> 0001
 4   set_r 00 -> 01
 4 set_index_rp hl -> ix
 4 disable_int
 4 m1_fetch
 4   fetch 6b at 0001
 4     get_pc_on_fetch 0001
 4     set_addr_bus 0000 -> 0001
 6     mreq_wait 0001
 6     get_ir_on_refresh 0001
 6     set_addr_bus 0001 -> 0001
 8     set_pc_on_fetch 0001 -> 0002
 8   set_r 01 -> 02
 8 get_e 00
 8 set_ixl 00 -> 00
 8 set_index_rp ix -> hl
 8 done

# 0x6e LD L,(REGISTER+dd)
fd6e12 ld l, (iy + 18)
 0 m1_fetch
 0   fetch fd at 0000
 0     get_pc_on_fetch 0000
 0     set_addr_bus 0000 -> 0000
 2     mreq_wait 0000
 2     get_ir_on_refresh 0000
 2     set_addr_bus 0000 -> 0000
 4     set_pc_on_fetch 0000 -> 0001
 4   set_r 00 -> 01
 4 set_index_rp hl -> iy
 4 disable_int
 4 m1_fetch
 4   fetch 6e at 0001
 4     get_pc_on_fetch 0001
 4     set_addr_bus 0000 -> 0001
 6     mreq_wait 0001
 6     get_ir_on_refresh 0001
 6     set_addr_bus 0001 -> 0001
 8     set_pc_on_fetch 0001 -> 0002
 8   set_r 01 -> 02
 8 disp_read 12 at 0002
 8   get_pc_on_disp_read 0002
 8   read 12 at 0002
 8     set_addr_bus 0001 -> 0002
10     mreq_wait 0002
11   set_pc_on_disp_read 0002 -> 0003
11 5t_exec
16 get_iyl 00
16 get_iyh 00
16 read 00 at 0012
16   set_addr_bus 0002 -> 0012
18   mreq_wait 0012
19 set_wz 0000 -> 0012
19 set_l 00 -> 00
19 set_index_rp iy -> hl
19 done

# LD r, n
3eaf ld a, 0xaf
 0 m1_fetch
 0   fetch 3e at 0000
 0     get_pc_on_fetch 0000
 0     set_addr_bus 0000 -> 0000
 2     mreq_wait 0000
 2     get_ir_on_refresh 0000
 2     set_addr_bus 0000 -> 0000
 4     set_pc_on_fetch 0000 -> 0001
 4   set_r 00 -> 01
 4 imm8_read af at 0001
 4   get_pc_on_imm8_read 0001
 4   read af at 0001
 4     set_addr_bus 0000 -> 0001
 6     mreq_wait 0001
 7   set_pc_on_imm8_read 0001 -> 0002
 7 set_a 00 -> af
 7 done

3602 ld (hl), 0x02
 0 m1_fetch
 0   fetch 36 at 0000
 0     get_pc_on_fetch 0000
 0     set_addr_bus 0000 -> 0000
 2     mreq_wait 0000
 2     get_ir_on_refresh 0000
 2     set_addr_bus 0000 -> 0000
 4     set_pc_on_fetch 0000 -> 0001
 4   set_r 00 -> 01
 4 imm8_read 02 at 0001
 4   get_pc_on_imm8_read 0001
 4   read 02 at 0001
 4     set_addr_bus 0000 -> 0001
 6     mreq_wait 0001
 7   set_pc_on_imm8_read 0001 -> 0002
 7 get_l 00
 7 get_h 00
 7 write 36 -> 02 at 0000
 7   set_addr_bus 0001 -> 0000
 9   mreq_wait 0000
10 done

# LD I, A
ed47 ld i, a
 0 m1_fetch
 0   fetch ed at 0000
 0     get_pc_on_fetch 0000
 0     set_addr_bus 0000 -> 0000
 2     mreq_wait 0000
 2     get_ir_on_refresh 0000
 2     set_addr_bus 0000 -> 0000
 4     set_pc_on_fetch 0000 -> 0001
 4   set_r 00 -> 01
 4 m1_fetch
 4   fetch 47 at 0001
 4     get_pc_on_fetch 0001
 4     set_addr_bus 0000 -> 0001
 6     mreq_wait 0001
 6     get_ir_on_refresh 0001
 6     set_addr_bus 0001 -> 0001
 8     set_pc_on_fetch 0001 -> 0002
 8   set_r 01 -> 02
 8 fetch_cycle_extra_1t
 9 get_a 00
 9 set_i 00 -> 00
 9 done

# LD rp, nn
115634 ld de, 0x3456
 0 m1_fetch
 0   fetch 11 at 0000
 0     get_pc_on_fetch 0000
 0     set_addr_bus 0000 -> 0000
 2     mreq_wait 0000
 2     get_ir_on_refresh 0000
 2     set_addr_bus 0000 -> 0000
 4     set_pc_on_fetch 0000 -> 0001
 4   set_r 00 -> 01
 4 imm16_read 3456 at 0001
 4   get_pc_on_imm16_read 0001
 4   read 56 at 0001
 4     set_addr_bus 0000 -> 0001
 6     mreq_wait 0001
 7   read 34 at 0002
 7     set_addr_bus 0001 -> 0002
 9     mreq_wait 0002
10   set_pc_on_imm16_read 0001 -> 0003
10 set_e 00 -> 56
10 set_d 00 -> 34
10 done

fd213a5c ld iy, 0x5c3a
 0 m1_fetch
 0   fetch fd at 0000
 0     get_pc_on_fetch 0000
 0     set_addr_bus 0000 -> 0000
 2     mreq_wait 0000
 2     get_ir_on_refresh 0000
 2     set_addr_bus 0000 -> 0000
 4     set_pc_on_fetch 0000 -> 0001
 4   set_r 00 -> 01
 4 set_index_rp hl -> iy
 4 disable_int
 4 m1_fetch
 4   fetch 21 at 0001
 4     get_pc_on_fetch 0001
 4     set_addr_bus 0000 -> 0001
 6     mreq_wait 0001
 6     get_ir_on_refresh 0001
 6     set_addr_bus 0001 -> 0001
 8     set_pc_on_fetch 0001 -> 0002
 8   set_r 01 -> 02
 8 imm16_read 5c3a at 0002
 8   get_pc_on_imm16_read 0002
 8   read 3a at 0002
 8     set_addr_bus 0001 -> 0002
10     mreq_wait 0002
11   read 5c at 0003
11     set_addr_bus 0002 -> 0003
13     mreq_wait 0003
14   set_pc_on_imm16_read 0002 -> 0004
14 set_iyl 00 -> 3a
14 set_iyh 00 -> 5c
14 set_index_rp iy -> hl
14 done

dd21d103 ld ix, 0x03d1
 0 m1_fetch
 0   fetch dd at 0000
 0     get_pc_on_fetch 0000
 0     set_addr_bus 0000 -> 0000
 2     mreq_wait 0000
 2     get_ir_on_refresh 0000
 2     set_addr_bus 0000 -> 0000
 4     set_pc_on_fetch 0000 -> 0001
 4   set_r 00 -> 01
 4 set_index_rp hl -> ix
 4 disable_int
 4 m1_fetch
 4   fetch 21 at 0001
 4     get_pc_on_fetch 0001
 4     set_addr_bus 0000 -> 0001
 6     mreq_wait 0001
 6     get_ir_on_refresh 0001
 6     set_addr_bus 0001 -> 0001
 8     set_pc_on_fetch 0001 -> 0002
 8   set_r 01 -> 02
 8 imm16_read 03d1 at 0002
 8   get_pc_on_imm16_read 0002
 8   read d1 at 0002
 8     set_addr_bus 0001 -> 0002
10     mreq_wait 0002
11   read 03 at 0003
11     set_addr_bus 0002 -> 0003
13     mreq_wait 0003
14   set_pc_on_imm16_read 0002 -> 0004
14 set_ixl 00 -> d1
14 set_ixh 00 -> 03
14 set_index_rp ix -> hl
14 done

# LD rp, (nn)
ed4bb45c ld bc, (0x5cb4)
 0 m1_fetch
 0   fetch ed at 0000
 0     get_pc_on_fetch 0000
 0     set_addr_bus 0000 -> 0000
 2     mreq_wait 0000
 2     get_ir_on_refresh 0000
 2     set_addr_bus 0000 -> 0000
 4     set_pc_on_fetch 0000 -> 0001
 4   set_r 00 -> 01
 4 m1_fetch
 4   fetch 4b at 0001
 4     get_pc_on_fetch 0001
 4     set_addr_bus 0000 -> 0001
 6     mreq_wait 0001
 6     get_ir_on_refresh 0001
 6     set_addr_bus 0001 -> 0001
 8     set_pc_on_fetch 0001 -> 0002
 8   set_r 01 -> 02
 8 imm16_read 5cb4 at 0002
 8   get_pc_on_imm16_read 0002
 8   read b4 at 0002
 8     set_addr_bus 0001 -> 0002
10     mreq_wait 0002
11   read 5c at 0003
11     set_addr_bus 0002 -> 0003
13     mreq_wait 0003
14   set_pc_on_imm16_read 0002 -> 0004
14 read 00 at 5cb4
14   set_addr_bus 0003 -> 5cb4
16   mreq_wait 5cb4
17 set_wz 0000 -> 5cb5
17 read 00 at 5cb5
17   set_addr_bus 5cb4 -> 5cb5
19   mreq_wait 5cb5
20 set_c 00 -> 00
20 set_b 00 -> 00
20 done

# LD irp, (nn)
2ab25c ld hl, (0x5cb2)
 0 m1_fetch
 0   fetch 2a at 0000
 0     get_pc_on_fetch 0000
 0     set_addr_bus 0000 -> 0000
 2     mreq_wait 0000
 2     get_ir_on_refresh 0000
 2     set_addr_bus 0000 -> 0000
 4     set_pc_on_fetch 0000 -> 0001
 4   set_r 00 -> 01
 4 imm16_read 5cb2 at 0001
 4   get_pc_on_imm16_read 0001
 4   read b2 at 0001
 4     set_addr_bus 0000 -> 0001
 6     mreq_wait 0001
 7   read 5c at 0002
 7     set_addr_bus 0001 -> 0002
 9     mreq_wait 0002
10   set_pc_on_imm16_read 0001 -> 0003
10 read 00 at 5cb2
10   set_addr_bus 0002 -> 5cb2
12   mreq_wait 5cb2
13 set_wz 0000 -> 5cb3
13 read 00 at 5cb3
13   set_addr_bus 5cb2 -> 5cb3
15   mreq_wait 5cb3
16 set_l 00 -> 00
16 set_h 00 -> 00
16 done

# LD A, (nn)
3a8d5c ld a, (0x5c8d)
 0 m1_fetch
 0   fetch 3a at 0000
 0     get_pc_on_fetch 0000
 0     set_addr_bus 0000 -> 0000
 2     mreq_wait 0000
 2     get_ir_on_refresh 0000
 2     set_addr_bus 0000 -> 0000
 4     set_pc_on_fetch 0000 -> 0001
 4   set_r 00 -> 01
 4 imm16_read 5c8d at 0001
 4   get_pc_on_imm16_read 0001
 4   read 8d at 0001
 4     set_addr_bus 0000 -> 0001
 6     mreq_wait 0001
 7   read 5c at 0002
 7     set_addr_bus 0001 -> 0002
 9     mreq_wait 0002
10   set_pc_on_imm16_read 0001 -> 0003
10 set_wz 0000 -> 5c8e
10 read 00 at 5c8d
10   set_addr_bus 0002 -> 5c8d
12   mreq_wait 5c8d
13 set_a 00 -> 00
13 done

# LD (nn), A
328d5c ld (0x5c8d), a
 0 m1_fetch
 0   fetch 32 at 0000
 0     get_pc_on_fetch 0000
 0     set_addr_bus 0000 -> 0000
 2     mreq_wait 0000
 2     get_ir_on_refresh 0000
 2     set_addr_bus 0000 -> 0000
 4     set_pc_on_fetch 0000 -> 0001
 4   set_r 00 -> 01
 4 imm16_read 5c8d at 0001
 4   get_pc_on_imm16_read 0001
 4   read 8d at 0001
 4     set_addr_bus 0000 -> 0001
 6     mreq_wait 0001
 7   read 5c at 0002
 7     set_addr_bus 0001 -> 0002
 9     mreq_wait 0002
10   set_pc_on_imm16_read 0001 -> 0003
10 get_a 00
10 set_wz 0000 -> 008e
10 write 00 -> 00 at 5c8d
10   set_addr_bus 0002 -> 5c8d
12   mreq_wait 5c8d
13 done

# LD (nn), irp
227b5c ld (0x5c7b), hl
 0 m1_fetch
 0   fetch 22 at 0000
 0     get_pc_on_fetch 0000
 0     set_addr_bus 0000 -> 0000
 2     mreq_wait 0000
 2     get_ir_on_refresh 0000
 2     set_addr_bus 0000 -> 0000
 4     set_pc_on_fetch 0000 -> 0001
 4   set_r 00 -> 01
 4 imm16_read 5c7b at 0001
 4   get_pc_on_imm16_read 0001
 4   read 7b at 0001
 4     set_addr_bus 0000 -> 0001
 6     mreq_wait 0001
 7   read 5c at 0002
 7     set_addr_bus 0001 -> 0002
 9     mreq_wait 0002
10   set_pc_on_imm16_read 0001 -> 0003
10 get_l 00
10 get_h 00
10 write 00 -> 00 at 5c7b
10   set_addr_bus 0002 -> 5c7b
12   mreq_wait 5c7b
13 set_wz 0000 -> 5c7c
13 write 00 -> 00 at 5c7c
13   set_addr_bus 5c7b -> 5c7c
15   mreq_wait 5c7c
16 done

# LD (nn), rp
ed43b45c ld (0x5cb4), bc
 0 m1_fetch
 0   fetch ed at 0000
 0     get_pc_on_fetch 0000
 0     set_addr_bus 0000 -> 0000
 2     mreq_wait 0000
 2     get_ir_on_refresh 0000
 2     set_addr_bus 0000 -> 0000
 4     set_pc_on_fetch 0000 -> 0001
 4   set_r 00 -> 01
 4 m1_fetch
 4   fetch 43 at 0001
 4     get_pc_on_fetch 0001
 4     set_addr_bus 0000 -> 0001
 6     mreq_wait 0001
 6     get_ir_on_refresh 0001
 6     set_addr_bus 0001 -> 0001
 8     set_pc_on_fetch 0001 -> 0002
 8   set_r 01 -> 02
 8 imm16_read 5cb4 at 0002
 8   get_pc_on_imm16_read 0002
 8   read b4 at 0002
 8     set_addr_bus 0001 -> 0002
10     mreq_wait 0002
11   read 5c at 0003
11     set_addr_bus 0002 -> 0003
13     mreq_wait 0003
14   set_pc_on_imm16_read 0002 -> 0004
14 get_c 00
14 get_b 00
14 write 00 -> 00 at 5cb4
14   set_addr_bus 0003 -> 5cb4
16   mreq_wait 5cb4
17 set_wz 0000 -> 5cb5
17 write 00 -> 00 at 5cb5
17   set_addr_bus 5cb4 -> 5cb5
19   mreq_wait 5cb5
20 done

# LD A, (rp)
1a ld a, (de)
 0 m1_fetch
 0   fetch 1a at 0000
 0     get_pc_on_fetch 0000
 0     set_addr_bus 0000 -> 0000
 2     mreq_wait 0000
 2     get_ir_on_refresh 0000
 2     set_addr_bus 0000 -> 0000
 4     set_pc_on_fetch 0000 -> 0001
 4   set_r 00 -> 01
 4 get_e 00
 4 get_d 00
 4 set_wz 0000 -> 0001
 4 read 1a at 0000
 4   set_addr_bus 0000 -> 0000
 6   mreq_wait 0000
 7 set_a 00 -> 1a
 7 done

# LD (rp), A
12 ld (de), a
 0 m1_fetch
 0   fetch 12 at 0000
 0     get_pc_on_fetch 0000
 0     set_addr_bus 0000 -> 0000
 2     mreq_wait 0000
 2     get_ir_on_refresh 0000
 2     set_addr_bus 0000 -> 0000
 4     set_pc_on_fetch 0000 -> 0001
 4   set_r 00 -> 01
 4 get_e 00
 4 get_d 00
 4 get_a 00
 4 set_wz 0000 -> 0001
 4 write 12 -> 00 at 0000
 4   set_addr_bus 0000 -> 0000
 6   mreq_wait 0000
 7 done

# LD SP, irp
f9 ld sp, hl
 0 m1_fetch
 0   fetch f9 at 0000
 0     get_pc_on_fetch 0000
 0     set_addr_bus 0000 -> 0000
 2     mreq_wait 0000
 2     get_ir_on_refresh 0000
 2     set_addr_bus 0000 -> 0000
 4     set_pc_on_fetch 0000 -> 0001
 4   set_r 00 -> 01
 4 fetch_cycle_extra_2t
 6 get_l 00
 6 get_h 00
 6 set_sp 0000 -> 0000
 6 done

# Block transfers.
edb8 lddr
 0 m1_fetch
 0   fetch ed at 0000
 0     get_pc_on_fetch 0000
 0     set_addr_bus 0000 -> 0000
 2     mreq_wait 0000
 2     get_ir_on_refresh 0000
 2     set_addr_bus 0000 -> 0000
 4     set_pc_on_fetch 0000 -> 0001
 4   set_r 00 -> 01
 4 m1_fetch
 4   fetch b8 at 0001
 4     get_pc_on_fetch 0001
 4     set_addr_bus 0000 -> 0001
 6     mreq_wait 0001
 6     get_ir_on_refresh 0001
 6     set_addr_bus 0001 -> 0001
 8     set_pc_on_fetch 0001 -> 0002
 8   set_r 01 -> 02
 8 get_c 00
 8 get_b 00
 8 get_e 00
 8 get_d 00
 8 get_l 00
 8 get_h 00
 8 get_a 00
 8 get_f 00
 8 read ed at 0000
 8   set_addr_bus 0001 -> 0000
10   mreq_wait 0000
11 write ed -> ed at 0000
11   set_addr_bus 0000 -> 0000
13   mreq_wait 0000
14 write_cycle_extra_2t
16 set_c 00 -> ff
16 set_b 00 -> ff
16 set_e 00 -> ff
16 set_d 00 -> ff
16 set_l 00 -> ff
16 set_h 00 -> ff
16 set_f 00 -> 0c
16 5t_exec
21 get_pc_on_block_instr 0002
21 set_wz 0000 -> 0001
21 set_pc_on_block_instr 0002 -> 0000
21 done

# NEG
ed44 neg
 0 m1_fetch
 0   fetch ed at 0000
 0     get_pc_on_fetch 0000
 0     set_addr_bus 0000 -> 0000
 2     mreq_wait 0000
 2     get_ir_on_refresh 0000
 2     set_addr_bus 0000 -> 0000
 4     set_pc_on_fetch 0000 -> 0001
 4   set_r 00 -> 01
 4 m1_fetch
 4   fetch 44 at 0001
 4     get_pc_on_fetch 0001
 4     set_addr_bus 0000 -> 0001
 6     mreq_wait 0001
 6     get_ir_on_refresh 0001
 6     set_addr_bus 0001 -> 0001
 8     set_pc_on_fetch 0001 -> 0002
 8   set_r 01 -> 02
 8 get_a 00
 8 get_f 00
 8 set_a 00 -> 00
 8 set_f 00 -> 42
 8 done

ed4c xneg 0x4c
...
 8 done

ed7c xneg 0x7c
...
 8 done

# NOP
00 nop
 0 m1_fetch
 0   fetch 00 at 0000
 0     get_pc_on_fetch 0000
 0     set_addr_bus 0000 -> 0000
 2     mreq_wait 0000
 2     get_ir_on_refresh 0000
 2     set_addr_bus 0000 -> 0000
 4     set_pc_on_fetch 0000 -> 0001
 4   set_r 00 -> 01
 4 done

ed00 xnop 0xed00
...
 8 done

ed3f xnop 0xed3f
...
 8 done

ed77 xnop 0xed77
...
 8 done

ed7f xnop 0xed7f
...
 8 done

ed80 xnop 0xed80
...
 8 done

ed87 xnop 0xed87
...
 8 done

ed9f xnop 0xed9f
...
 8 done

eda4 xnop 0xeda4
...
 8 done

eda7 xnop 0xeda7
...
 8 done

edac xnop 0xedac
...
 8 done

edaf xnop 0xedaf
...
 8 done

edb4 xnop 0xedb4
...
 8 done

edb7 xnop 0xedb7
...
 8 done

edbc xnop 0xedbc
...
 8 done

edbf xnop 0xedbf
...
 8 done

edc0 xnop 0xedc0
...
 8 done

edff xnop 0xedff
...
 8 done

# OR r
b3 or e
 0 m1_fetch
 0   fetch b3 at 0000
 0     get_pc_on_fetch 0000
 0     set_addr_bus 0000 -> 0000
 2     mreq_wait 0000
 2     get_ir_on_refresh 0000
 2     set_addr_bus 0000 -> 0000
 4     set_pc_on_fetch 0000 -> 0001
 4   set_r 00 -> 01
 4 get_e 00
 4 get_a 00
 4 set_a 00 -> 00
 4 set_f 00 -> 44
 4 done

# OUT (C), r
ed79 out (c), a
 0 m1_fetch
 0   fetch ed at 0000
 0     get_pc_on_fetch 0000
 0     set_addr_bus 0000 -> 0000
 2     mreq_wait 0000
 2     get_ir_on_refresh 0000
 2     set_addr_bus 0000 -> 0000
 4     set_pc_on_fetch 0000 -> 0001
 4   set_r 00 -> 01
 4 m1_fetch
 4   fetch 79 at 0001
 4     get_pc_on_fetch 0001
 4     set_addr_bus 0000 -> 0001
 6     mreq_wait 0001
 6     get_ir_on_refresh 0001
 6     set_addr_bus 0001 -> 0001
 8     set_pc_on_fetch 0001 -> 0002
 8   set_r 01 -> 02
 8 get_c 00
 8 get_b 00
 8 set_wz 0000 -> 0001
 8 get_a 00
 8 output 00 at 0000
 8   set_addr_bus 0001 -> 0000
11   iorq_wait 0000
12 done

# Block input.
edb2 inir
 0 m1_fetch
 0   fetch ed at 0000
 0     get_pc_on_fetch 0000
 0     set_addr_bus 0000 -> 0000
 2     mreq_wait 0000
 2     get_ir_on_refresh 0000
 2     set_addr_bus 0000 -> 0000
 4     set_pc_on_fetch 0000 -> 0001
 4   set_r 00 -> 01
 4 m1_fetch
 4   fetch b2 at 0001
 4     get_pc_on_fetch 0001
 4     set_addr_bus 0000 -> 0001
 6     mreq_wait 0001
 6     get_ir_on_refresh 0001
 6     set_addr_bus 0001 -> 0001
 8     set_pc_on_fetch 0001 -> 0002
 8   set_r 01 -> 02
 8 get_c 00
 8 get_b 00
 8 get_l 00
 8 get_h 00
 8 get_f 00
 8 fetch_cycle_extra_1t
 9 input at ff00
 9   set_addr_bus 0001 -> ff00
12   iorq_wait ff00
13 write ed -> ff at 0000
13   set_addr_bus ff00 -> 0000
15   mreq_wait 0000
16 set_c 00 -> 00
16 set_b 00 -> ff
16 set_wz 0000 -> ff01
16 set_l 00 -> 01
16 set_h 00 -> 00
16 set_f 00 -> bf
16 5t_exec
21 get_pc_on_block_instr 0002
21 set_pc_on_block_instr 0002 -> 0000
21 done

# Block output.
edb3 otir
 0 m1_fetch
 0   fetch ed at 0000
 0     get_pc_on_fetch 0000
 0     set_addr_bus 0000 -> 0000
 2     mreq_wait 0000
 2     get_ir_on_refresh 0000
 2     set_addr_bus 0000 -> 0000
 4     set_pc_on_fetch 0000 -> 0001
 4   set_r 00 -> 01
 4 m1_fetch
 4   fetch b3 at 0001
 4     get_pc_on_fetch 0001
 4     set_addr_bus 0000 -> 0001
 6     mreq_wait 0001
 6     get_ir_on_refresh 0001
 6     set_addr_bus 0001 -> 0001
 8     set_pc_on_fetch 0001 -> 0002
 8   set_r 01 -> 02
 8 get_c 00
 8 get_b 00
 8 get_l 00
 8 get_h 00
 8 get_f 00
 8 fetch_cycle_extra_1t
 9 read ed at 0000
 9   set_addr_bus 0001 -> 0000
11   mreq_wait 0000
12 output ed at ff00
12   set_addr_bus 0000 -> ff00
15   iorq_wait ff00
16 set_c 00 -> 00
16 set_b 00 -> ff
16 set_wz 0000 -> ff01
16 set_l 00 -> 01
16 set_h 00 -> 00
16 set_f 00 -> ae
16 5t_exec
21 get_pc_on_block_instr 0002
21 set_pc_on_block_instr 0002 -> 0000
21 done

# OUT (n), r
d3ab out (0xab), a
 0 m1_fetch
 0   fetch d3 at 0000
 0     get_pc_on_fetch 0000
 0     set_addr_bus 0000 -> 0000
 2     mreq_wait 0000
 2     get_ir_on_refresh 0000
 2     set_addr_bus 0000 -> 0000
 4     set_pc_on_fetch 0000 -> 0001
 4   set_r 00 -> 01
 4 imm8_read ab at 0001
 4   get_pc_on_imm8_read 0001
 4   read ab at 0001
 4     set_addr_bus 0000 -> 0001
 6     mreq_wait 0001
 7   set_pc_on_imm8_read 0001 -> 0002
 7 get_a 00
 7 output 00 at 00ab
 7   set_addr_bus 0001 -> 00ab
10   iorq_wait 00ab
11 set_wz 0000 -> 00ac
11 done

# POP rp2
c1 pop bc
 0 m1_fetch
 0   fetch c1 at 0000
 0     get_pc_on_fetch 0000
 0     set_addr_bus 0000 -> 0000
 2     mreq_wait 0000
 2     get_ir_on_refresh 0000
 2     set_addr_bus 0000 -> 0000
 4     set_pc_on_fetch 0000 -> 0001
 4   set_r 00 -> 01
 4 get_sp 0000
 4 read c1 at 0000
 4   set_addr_bus 0000 -> 0000
 6   mreq_wait 0000
 7 read 00 at 0001
 7   set_addr_bus 0000 -> 0001
 9   mreq_wait 0001
10 set_sp 0000 -> 0002
10 set_c 00 -> c1
10 set_b 00 -> 00
10 done

# PUSH rp2
c5 push bc
 0 m1_fetch
 0   fetch c5 at 0000
 0     get_pc_on_fetch 0000
 0     set_addr_bus 0000 -> 0000
 2     mreq_wait 0000
 2     get_ir_on_refresh 0000
 2     set_addr_bus 0000 -> 0000
 4     set_pc_on_fetch 0000 -> 0001
 4   set_r 00 -> 01
 4 fetch_cycle_extra_1t
 5 get_c 00
 5 get_b 00
 5 get_sp 0000
 5 write 00 -> 00 at ffff
 5   set_addr_bus 0000 -> ffff
 7   mreq_wait ffff
 8 write 00 -> 00 at fffe
 8   set_addr_bus ffff -> fffe
10   mreq_wait fffe
11 set_sp 0000 -> fffe
11 done

# rot r
cb00 rlc b
 0 m1_fetch
 0   fetch cb at 0000
 0     get_pc_on_fetch 0000
 0     set_addr_bus 0000 -> 0000
 2     mreq_wait 0000
 2     get_ir_on_refresh 0000
 2     set_addr_bus 0000 -> 0000
 4     set_pc_on_fetch 0000 -> 0001
 4   set_r 00 -> 01
 4 m1_fetch
 4   fetch 00 at 0001
 4     get_pc_on_fetch 0001
 4     set_addr_bus 0000 -> 0001
 6     mreq_wait 0001
 6     get_ir_on_refresh 0001
 6     set_addr_bus 0001 -> 0001
 8     set_pc_on_fetch 0001 -> 0002
 8   set_r 01 -> 02
 8 get_b 00
 8 get_f 00
 8 set_b 00 -> 00
 8 set_f 00 -> 44
 8 done

cb23 sla e
 0 m1_fetch
 0   fetch cb at 0000
 0     get_pc_on_fetch 0000
 0     set_addr_bus 0000 -> 0000
 2     mreq_wait 0000
 2     get_ir_on_refresh 0000
 2     set_addr_bus 0000 -> 0000
 4     set_pc_on_fetch 0000 -> 0001
 4   set_r 00 -> 01
 4 m1_fetch
 4   fetch 23 at 0001
 4     get_pc_on_fetch 0001
 4     set_addr_bus 0000 -> 0001
 6     mreq_wait 0001
 6     get_ir_on_refresh 0001
 6     set_addr_bus 0001 -> 0001
 8     set_pc_on_fetch 0001 -> 0002
 8   set_r 01 -> 02
 8 get_e 00
 8 get_f 00
 8 set_e 00 -> 00
 8 set_f 00 -> 44
 8 done

cb3c srl h
 0 m1_fetch
 0   fetch cb at 0000
 0     get_pc_on_fetch 0000
 0     set_addr_bus 0000 -> 0000
 2     mreq_wait 0000
 2     get_ir_on_refresh 0000
 2     set_addr_bus 0000 -> 0000
 4     set_pc_on_fetch 0000 -> 0001
 4   set_r 00 -> 01
 4 m1_fetch
 4   fetch 3c at 0001
 4     get_pc_on_fetch 0001
 4     set_addr_bus 0000 -> 0001
 6     mreq_wait 0001
 6     get_ir_on_refresh 0001
 6     set_addr_bus 0001 -> 0001
 8     set_pc_on_fetch 0001 -> 0002
 8   set_r 01 -> 02
 8 get_h 00
 8 get_f 00
 8 set_h 00 -> 00
 8 set_f 00 -> 44
 8 done

ddcb463e srl (ix + 70)
 0 m1_fetch
 0   fetch dd at 0000
 0     get_pc_on_fetch 0000
 0     set_addr_bus 0000 -> 0000
 2     mreq_wait 0000
 2     get_ir_on_refresh 0000
 2     set_addr_bus 0000 -> 0000
 4     set_pc_on_fetch 0000 -> 0001
 4   set_r 00 -> 01
 4 set_index_rp hl -> ix
 4 disable_int
 4 m1_fetch
 4   fetch cb at 0001
 4     get_pc_on_fetch 0001
 4     set_addr_bus 0000 -> 0001
 6     mreq_wait 0001
 6     get_ir_on_refresh 0001
 6     set_addr_bus 0001 -> 0001
 8     set_pc_on_fetch 0001 -> 0002
 8   set_r 01 -> 02
 8 disp_read 46 at 0002
 8   get_pc_on_disp_read 0002
 8   read 46 at 0002
 8     set_addr_bus 0001 -> 0002
10     mreq_wait 0002
11   set_pc_on_disp_read 0002 -> 0003
11 fetch 3e at 0003
11   get_pc_on_fetch 0003
11   set_addr_bus 0002 -> 0003
13   mreq_wait 0003
13   get_ir_on_refresh 0002
13   set_addr_bus 0003 -> 0002
15   set_pc_on_fetch 0003 -> 0004
15 fetch_cycle_extra_1t
16 get_ixl 00
16 get_ixh 00
16 read 00 at 0046
16   set_addr_bus 0002 -> 0046
18   mreq_wait 0046
19 read_cycle_extra_1t
20 set_wz 0000 -> 0046
20 get_f 00
20 get_ixl 00
20 get_ixh 00
20 write 00 -> 00 at 0046
20   set_addr_bus 0046 -> 0046
22   mreq_wait 0046
23 set_wz 0046 -> 0046
23 set_f 00 -> 44
23 set_index_rp ix -> hl
23 done

# RL r
cb11 rl c
 0 m1_fetch
 0   fetch cb at 0000
 0     get_pc_on_fetch 0000
 0     set_addr_bus 0000 -> 0000
 2     mreq_wait 0000
 2     get_ir_on_refresh 0000
 2     set_addr_bus 0000 -> 0000
 4     set_pc_on_fetch 0000 -> 0001
 4   set_r 00 -> 01
 4 m1_fetch
 4   fetch 11 at 0001
 4     get_pc_on_fetch 0001
 4     set_addr_bus 0000 -> 0001
 6     mreq_wait 0001
 6     get_ir_on_refresh 0001
 6     set_addr_bus 0001 -> 0001
 8     set_pc_on_fetch 0001 -> 0002
 8   set_r 01 -> 02
 8 get_c 00
 8 get_f 00
 8 set_c 00 -> 00
 8 set_f 00 -> 44
 8 done

# RLA
17 rla
 0 m1_fetch
 0   fetch 17 at 0000
 0     get_pc_on_fetch 0000
 0     set_addr_bus 0000 -> 0000
 2     mreq_wait 0000
 2     get_ir_on_refresh 0000
 2     set_addr_bus 0000 -> 0000
 4     set_pc_on_fetch 0000 -> 0001
 4   set_r 00 -> 01
 4 get_a 00
 4 get_f 00
 4 set_a 00 -> 00
 4 set_f 00 -> 00
 4 done

# RLCA
07 rlca
 0 m1_fetch
 0   fetch 07 at 0000
 0     get_pc_on_fetch 0000
 0     set_addr_bus 0000 -> 0000
 2     mreq_wait 0000
 2     get_ir_on_refresh 0000
 2     set_addr_bus 0000 -> 0000
 4     set_pc_on_fetch 0000 -> 0001
 4   set_r 00 -> 01
 4 get_a 00
 4 get_f 00
 4 set_a 00 -> 00
 4 set_f 00 -> 00
 4 done

# RLD
ed6f rld
 0 m1_fetch
 0   fetch ed at 0000
 0     get_pc_on_fetch 0000
 0     set_addr_bus 0000 -> 0000
 2     mreq_wait 0000
 2     get_ir_on_refresh 0000
 2     set_addr_bus 0000 -> 0000
 4     set_pc_on_fetch 0000 -> 0001
 4   set_r 00 -> 01
 4 m1_fetch
 4   fetch 6f at 0001
 4     get_pc_on_fetch 0001
 4     set_addr_bus 0000 -> 0001
 6     mreq_wait 0001
 6     get_ir_on_refresh 0001
 6     set_addr_bus 0001 -> 0001
 8     set_pc_on_fetch 0001 -> 0002
 8   set_r 01 -> 02
 8 get_a 00
 8 get_f 00
 8 get_l 00
 8 get_h 00
 8 set_wz 0000 -> 0001
 8 read ed at 0000
 8   set_addr_bus 0001 -> 0000
10   mreq_wait 0000
11 4t_exec
15 set_a 00 -> 0e
15 set_f 00 -> 08
15 write ed -> d0 at 0000
15   set_addr_bus 0000 -> 0000
17   mreq_wait 0000
18 done

# RRA
1f rra
 0 m1_fetch
 0   fetch 1f at 0000
 0     get_pc_on_fetch 0000
 0     set_addr_bus 0000 -> 0000
 2     mreq_wait 0000
 2     get_ir_on_refresh 0000
 2     set_addr_bus 0000 -> 0000
 4     set_pc_on_fetch 0000 -> 0001
 4   set_r 00 -> 01
 4 get_a 00
 4 get_f 00
 4 set_a 00 -> 00
 4 set_f 00 -> 00
 4 done

# RRC
cb08 rrc b
 0 m1_fetch
 0   fetch cb at 0000
 0     get_pc_on_fetch 0000
 0     set_addr_bus 0000 -> 0000
 2     mreq_wait 0000
 2     get_ir_on_refresh 0000
 2     set_addr_bus 0000 -> 0000
 4     set_pc_on_fetch 0000 -> 0001
 4   set_r 00 -> 01
 4 m1_fetch
 4   fetch 08 at 0001
 4     get_pc_on_fetch 0001
 4     set_addr_bus 0000 -> 0001
 6     mreq_wait 0001
 6     get_ir_on_refresh 0001
 6     set_addr_bus 0001 -> 0001
 8     set_pc_on_fetch 0001 -> 0002
 8   set_r 01 -> 02
 8 get_b 00
 8 get_f 00
 8 set_b 00 -> 00
 8 set_f 00 -> 44
 8 done

# RRCA
0f rrca
 0 m1_fetch
 0   fetch 0f at 0000
 0     get_pc_on_fetch 0000
 0     set_addr_bus 0000 -> 0000
 2     mreq_wait 0000
 2     get_ir_on_refresh 0000
 2     set_addr_bus 0000 -> 0000
 4     set_pc_on_fetch 0000 -> 0001
 4   set_r 00 -> 01
 4 get_a 00
 4 get_f 00
 4 set_a 00 -> 00
 4 set_f 00 -> 00
 4 done

# RRD
ed67 rrd
 0 m1_fetch
 0   fetch ed at 0000
 0     get_pc_on_fetch 0000
 0     set_addr_bus 0000 -> 0000
 2     mreq_wait 0000
 2     get_ir_on_refresh 0000
 2     set_addr_bus 0000 -> 0000
 4     set_pc_on_fetch 0000 -> 0001
 4   set_r 00 -> 01
 4 m1_fetch
 4   fetch 67 at 0001
 4     get_pc_on_fetch 0001
 4     set_addr_bus 0000 -> 0001
 6     mreq_wait 0001
 6     get_ir_on_refresh 0001
 6     set_addr_bus 0001 -> 0001
 8     set_pc_on_fetch 0001 -> 0002
 8   set_r 01 -> 02
 8 get_a 00
 8 get_f 00
 8 get_l 00
 8 get_h 00
 8 set_wz 0000 -> 0001
 8 read ed at 0000
 8   set_addr_bus 0001 -> 0000
10   mreq_wait 0000
11 4t_exec
15 set_a 00 -> 0d
15 set_f 00 -> 08
15 write ed -> 0e at 0000
15   set_addr_bus 0000 -> 0000
17   mreq_wait 0000
18 done

# RST nn
d7 rst 0x0010
 0 m1_fetch
 0   fetch d7 at 0000
 0     get_pc_on_fetch 0000
 0     set_addr_bus 0000 -> 0000
 2     mreq_wait 0000
 2     get_ir_on_refresh 0000
 2     set_addr_bus 0000 -> 0000
 4     set_pc_on_fetch 0000 -> 0001
 4   set_r 00 -> 01
 4 fetch_cycle_extra_1t
 5 get_sp 0000
 5 write 00 -> 00 at ffff
 5   set_addr_bus 0000 -> ffff
 7   mreq_wait ffff
 8 write 00 -> 01 at fffe
 8   set_addr_bus ffff -> fffe
10   mreq_wait fffe
11 set_sp 0000 -> fffe
11 set_wz 0000 -> 0010
11 set_pc_on_call 0001 -> 0010
11 done

# RES b, r
fdcb308e res 1, (iy + 48)
 0 m1_fetch
 0   fetch fd at 0000
 0     get_pc_on_fetch 0000
 0     set_addr_bus 0000 -> 0000
 2     mreq_wait 0000
 2     get_ir_on_refresh 0000
 2     set_addr_bus 0000 -> 0000
 4     set_pc_on_fetch 0000 -> 0001
 4   set_r 00 -> 01
 4 set_index_rp hl -> iy
 4 disable_int
 4 m1_fetch
 4   fetch cb at 0001
 4     get_pc_on_fetch 0001
 4     set_addr_bus 0000 -> 0001
 6     mreq_wait 0001
 6     get_ir_on_refresh 0001
 6     set_addr_bus 0001 -> 0001
 8     set_pc_on_fetch 0001 -> 0002
 8   set_r 01 -> 02
 8 disp_read 30 at 0002
 8   get_pc_on_disp_read 0002
 8   read 30 at 0002
 8     set_addr_bus 0001 -> 0002
10     mreq_wait 0002
11   set_pc_on_disp_read 0002 -> 0003
11 fetch 8e at 0003
11   get_pc_on_fetch 0003
11   set_addr_bus 0002 -> 0003
13   mreq_wait 0003
13   get_ir_on_refresh 0002
13   set_addr_bus 0003 -> 0002
15   set_pc_on_fetch 0003 -> 0004
15 fetch_cycle_extra_1t
16 get_iyl 00
16 get_iyh 00
16 read 00 at 0030
16   set_addr_bus 0002 -> 0030
18   mreq_wait 0030
19 read_cycle_extra_1t
20 set_wz 0000 -> 0030
20 get_iyl 00
20 get_iyh 00
20 write 00 -> 00 at 0030
20   set_addr_bus 0030 -> 0030
22   mreq_wait 0030
23 set_wz 0030 -> 0030
23 set_index_rp iy -> hl
23 done

# RET
c9 ret
 0 m1_fetch
 0   fetch c9 at 0000
 0     get_pc_on_fetch 0000
 0     set_addr_bus 0000 -> 0000
 2     mreq_wait 0000
 2     get_ir_on_refresh 0000
 2     set_addr_bus 0000 -> 0000
 4     set_pc_on_fetch 0000 -> 0001
 4   set_r 00 -> 01
 4 get_sp 0000
 4 read c9 at 0000
 4   set_addr_bus 0000 -> 0000
 6   mreq_wait 0000
 7 read 00 at 0001
 7   set_addr_bus 0000 -> 0001
 9   mreq_wait 0001
10 set_sp 0000 -> 0002
10 set_wz 0000 -> 00c9
10 set_pc_on_return 0001 -> 00c9
10 done

# RET cc
c0 ret nz
 0 m1_fetch
 0   fetch c0 at 0000
 0     get_pc_on_fetch 0000
 0     set_addr_bus 0000 -> 0000
 2     mreq_wait 0000
 2     get_ir_on_refresh 0000
 2     set_addr_bus 0000 -> 0000
 4     set_pc_on_fetch 0000 -> 0001
 4   set_r 00 -> 01
 4 fetch_cycle_extra_1t
 5 get_f 00
 5 get_sp 0000
 5 read c0 at 0000
 5   set_addr_bus 0000 -> 0000
 7   mreq_wait 0000
 8 read 00 at 0001
 8   set_addr_bus 0000 -> 0001
10   mreq_wait 0001
11 set_sp 0000 -> 0002
11 set_wz 0000 -> 00c0
11 set_pc_on_return 0001 -> 00c0
11 done

# RETI
ed4d reti
 0 m1_fetch
 0   fetch ed at 0000
 0     get_pc_on_fetch 0000
 0     set_addr_bus 0000 -> 0000
 2     mreq_wait 0000
 2     get_ir_on_refresh 0000
 2     set_addr_bus 0000 -> 0000
 4     set_pc_on_fetch 0000 -> 0001
 4   set_r 00 -> 01
 4 m1_fetch
 4   fetch 4d at 0001
 4     get_pc_on_fetch 0001
 4     set_addr_bus 0000 -> 0001
 6     mreq_wait 0001
 6     get_ir_on_refresh 0001
 6     set_addr_bus 0001 -> 0001
 8     set_pc_on_fetch 0001 -> 0002
 8   set_r 01 -> 02
 8 get_sp 0000
 8 read ed at 0000
 8   set_addr_bus 0001 -> 0000
10   mreq_wait 0000
11 read 4d at 0001
11   set_addr_bus 0000 -> 0001
13   mreq_wait 0001
14 set_sp 0000 -> 0002
14 set_wz 0000 -> 4ded
14 set_pc_on_return 0002 -> 4ded
14 done

# RETN
ed45 retn
 0 m1_fetch
 0   fetch ed at 0000
 0     get_pc_on_fetch 0000
 0     set_addr_bus 0000 -> 0000
 2     mreq_wait 0000
 2     get_ir_on_refresh 0000
 2     set_addr_bus 0000 -> 0000
 4     set_pc_on_fetch 0000 -> 0001
 4   set_r 00 -> 01
 4 m1_fetch
 4   fetch 45 at 0001
 4     get_pc_on_fetch 0001
 4     set_addr_bus 0000 -> 0001
 6     mreq_wait 0001
 6     get_ir_on_refresh 0001
 6     set_addr_bus 0001 -> 0001
 8     set_pc_on_fetch 0001 -> 0002
 8   set_r 01 -> 02
 8 get_sp 0000
 8 read ed at 0000
 8   set_addr_bus 0001 -> 0000
10   mreq_wait 0000
11 read 45 at 0001
11   set_addr_bus 0000 -> 0001
13   mreq_wait 0001
14 set_sp 0000 -> 0002
14 set_wz 0000 -> 45ed
14 set_pc_on_return 0002 -> 45ed
14 done

ed55 xretn 0x55
...
14 done

ed5d xretn 0x5d
...
14 done

ed65 xretn 0x65
...
14 done

ed6d xretn 0x6d
...
14 done

ed75 xretn 0x75
...
14 done

ed7d xretn 0x7d
...
14 done

# RR
cb18 rr b
 0 m1_fetch
 0   fetch cb at 0000
 0     get_pc_on_fetch 0000
 0     set_addr_bus 0000 -> 0000
 2     mreq_wait 0000
 2     get_ir_on_refresh 0000
 2     set_addr_bus 0000 -> 0000
 4     set_pc_on_fetch 0000 -> 0001
 4   set_r 00 -> 01
 4 m1_fetch
 4   fetch 18 at 0001
 4     get_pc_on_fetch 0001
 4     set_addr_bus 0000 -> 0001
 6     mreq_wait 0001
 6     get_ir_on_refresh 0001
 6     set_addr_bus 0001 -> 0001
 8     set_pc_on_fetch 0001 -> 0002
 8   set_r 01 -> 02
 8 get_b 00
 8 get_f 00
 8 set_b 00 -> 00
 8 set_f 00 -> 44
 8 done

# SBC r
9f sbc a, a
 0 m1_fetch
 0   fetch 9f at 0000
 0     get_pc_on_fetch 0000
 0     set_addr_bus 0000 -> 0000
 2     mreq_wait 0000
 2     get_ir_on_refresh 0000
 2     set_addr_bus 0000 -> 0000
 4     set_pc_on_fetch 0000 -> 0001
 4   set_r 00 -> 01
 4 get_a 00
 4 get_a 00
 4 get_f 00
 4 set_a 00 -> 00
 4 set_f 00 -> 42
 4 done

# SBC HL, rp
ed52 sbc hl, de
 0 m1_fetch
 0   fetch ed at 0000
 0     get_pc_on_fetch 0000
 0     set_addr_bus 0000 -> 0000
 2     mreq_wait 0000
 2     get_ir_on_refresh 0000
 2     set_addr_bus 0000 -> 0000
 4     set_pc_on_fetch 0000 -> 0001
 4   set_r 00 -> 01
 4 m1_fetch
 4   fetch 52 at 0001
 4     get_pc_on_fetch 0001
 4     set_addr_bus 0000 -> 0001
 6     mreq_wait 0001
 6     get_ir_on_refresh 0001
 6     set_addr_bus 0001 -> 0001
 8     set_pc_on_fetch 0001 -> 0002
 8   set_r 01 -> 02
 8 get_l 00
 8 get_h 00
 8 get_e 00
 8 get_d 00
 8 get_f 00
 8 4t_exec
12 3t_exec
15 set_wz 0000 -> 0001
15 set_l 00 -> 00
15 set_h 00 -> 00
15 set_f 00 -> 42
15 done

# SCF
37 scf
 0 m1_fetch
 0   fetch 37 at 0000
 0     get_pc_on_fetch 0000
 0     set_addr_bus 0000 -> 0000
 2     mreq_wait 0000
 2     get_ir_on_refresh 0000
 2     set_addr_bus 0000 -> 0000
 4     set_pc_on_fetch 0000 -> 0001
 4   set_r 00 -> 01
 4 get_a 00
 4 get_f 00
 4 set_f 00 -> 01
 4 done

# SET b, r
fdcb01ce set 1, (iy + 1)
 0 m1_fetch
 0   fetch fd at 0000
 0     get_pc_on_fetch 0000
 0     set_addr_bus 0000 -> 0000
 2     mreq_wait 0000
 2     get_ir_on_refresh 0000
 2     set_addr_bus 0000 -> 0000
 4     set_pc_on_fetch 0000 -> 0001
 4   set_r 00 -> 01
 4 set_index_rp hl -> iy
 4 disable_int
 4 m1_fetch
 4   fetch cb at 0001
 4     get_pc_on_fetch 0001
 4     set_addr_bus 0000 -> 0001
 6     mreq_wait 0001
 6     get_ir_on_refresh 0001
 6     set_addr_bus 0001 -> 0001
 8     set_pc_on_fetch 0001 -> 0002
 8   set_r 01 -> 02
 8 disp_read 01 at 0002
 8   get_pc_on_disp_read 0002
 8   read 01 at 0002
 8     set_addr_bus 0001 -> 0002
10     mreq_wait 0002
11   set_pc_on_disp_read 0002 -> 0003
11 fetch ce at 0003
11   get_pc_on_fetch 0003
11   set_addr_bus 0002 -> 0003
13   mreq_wait 0003
13   get_ir_on_refresh 0002
13   set_addr_bus 0003 -> 0002
15   set_pc_on_fetch 0003 -> 0004
15 fetch_cycle_extra_1t
16 get_iyl 00
16 get_iyh 00
16 read cb at 0001
16   set_addr_bus 0002 -> 0001
18   mreq_wait 0001
19 read_cycle_extra_1t
20 set_wz 0000 -> 0001
20 get_iyl 00
20 get_iyh 00
20 write cb -> cb at 0001
20   set_addr_bus 0001 -> 0001
22   mreq_wait 0001
23 set_wz 0001 -> 0001
23 set_index_rp iy -> hl
23 done

# SLL r
cb30 sll b
 0 m1_fetch
 0   fetch cb at 0000
 0     get_pc_on_fetch 0000
 0     set_addr_bus 0000 -> 0000
 2     mreq_wait 0000
 2     get_ir_on_refresh 0000
 2     set_addr_bus 0000 -> 0000
 4     set_pc_on_fetch 0000 -> 0001
 4   set_r 00 -> 01
 4 m1_fetch
 4   fetch 30 at 0001
 4     get_pc_on_fetch 0001
 4     set_addr_bus 0000 -> 0001
 6     mreq_wait 0001
 6     get_ir_on_refresh 0001
 6     set_addr_bus 0001 -> 0001
 8     set_pc_on_fetch 0001 -> 0002
 8   set_r 01 -> 02
 8 get_b 00
 8 get_f 00
 8 set_b 00 -> 01
 8 set_f 00 -> 00
 8 done

# Test that CF is computed from the original value of the operand.
.b=80
cb30 sll b
...
 8 set_b 80 -> 01
 8 set_f 00 -> 01
 8 done

# SRA r
cb28 sra b
 0 m1_fetch
 0   fetch cb at 0000
 0     get_pc_on_fetch 0000
 0     set_addr_bus 0000 -> 0000
 2     mreq_wait 0000
 2     get_ir_on_refresh 0000
 2     set_addr_bus 0000 -> 0000
 4     set_pc_on_fetch 0000 -> 0001
 4   set_r 00 -> 01
 4 m1_fetch
 4   fetch 28 at 0001
 4     get_pc_on_fetch 0001
 4     set_addr_bus 0000 -> 0001
 6     mreq_wait 0001
 6     get_ir_on_refresh 0001
 6     set_addr_bus 0001 -> 0001
 8     set_pc_on_fetch 0001 -> 0002
 8   set_r 01 -> 02
 8 get_b 00
 8 get_f 00
 8 set_b 00 -> 00
 8 set_f 00 -> 44
 8 done

# Test that CF is computed from the original value of the operand.
.b=01
cb28 sra b
...
 8 set_b 01 -> 00
 8 set_f 00 -> 45
 8 done

# SUB r
91 sub c
 0 m1_fetch
 0   fetch 91 at 0000
 0     get_pc_on_fetch 0000
 0     set_addr_bus 0000 -> 0000
 2     mreq_wait 0000
 2     get_ir_on_refresh 0000
 2     set_addr_bus 0000 -> 0000
 4     set_pc_on_fetch 0000 -> 0001
 4   set_r 00 -> 01
 4 get_c 00
 4 get_a 00
 4 set_a 00 -> 00
 4 set_f 00 -> 42
 4 done

# XOR r
af xor a
 0 m1_fetch
 0   fetch af at 0000
 0     get_pc_on_fetch 0000
 0     set_addr_bus 0000 -> 0000
 2     mreq_wait 0000
 2     get_ir_on_refresh 0000
 2     set_addr_bus 0000 -> 0000
 4     set_pc_on_fetch 0000 -> 0001
 4   set_r 00 -> 01
 4 get_a 00
 4 get_a 00
 4 set_a 00 -> 00
 4 set_f 00 -> 44
 4 done
